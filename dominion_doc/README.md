# Dominion Staff Migration - Documentation Index

**Migration Date:** TBD  
**Staff Count:** 46  
**Strategy:** Hybrid (Bulk Import + Self-Service Completion)

---

## ğŸ“š DOCUMENTATION OVERVIEW

This folder contains everything you need to migrate 46 Dominion staff to ACG StaffLink.

### ğŸ¯ Start Here

1. **[MIGRATION_EXECUTIVE_SUMMARY.md](MIGRATION_EXECUTIVE_SUMMARY.md)** â­ READ THIS FIRST
   - High-level overview
   - The problem, the solution, and why it works
   - Decision points and approval checklist
   - 5-minute read

2. **[DOMINION_STAFF_MIGRATION_STRATEGIC_PLAN.md](DOMINION_STAFF_MIGRATION_STRATEGIC_PLAN.md)** ğŸ“‹ DETAILED PLAN
   - Complete audit findings
   - All 3 migration options compared
   - Step-by-step implementation guide
   - Data cleaning requirements
   - SQL verification queries
   - Support & escalation procedures
   - 20-minute read

3. **[MIGRATION_CHECKLIST.md](MIGRATION_CHECKLIST.md)** âœ… EXECUTION GUIDE
   - Print this and check off as you go
   - Phase-by-phase checklist
   - SQL queries for verification
   - Success criteria tracking
   - Rollback plan

---

## ğŸ› ï¸ TOOLS & SCRIPTS

### Data Cleaning
- **[clean_staff_data.js](clean_staff_data.js)** - Node.js script to clean CSV data
  - Fixes phone numbers (+44 prefix)
  - Normalizes roles and employment types
  - Detects duplicates
  - Generates validation-ready CSV

### Email Templates
- **[WELCOME_EMAIL_TEMPLATE.html](WELCOME_EMAIL_TEMPLATE.html)** - Welcome email for staff
  - Professional HTML template
  - Includes login instructions
  - Explains ACG StaffLink features
  - Support contact information

---

## ğŸ“Š SOURCE DATA

- **[DHCS - STAFF NAME  SORTED.csv](DHCS - STAFF NAME  SORTED.csv)** - Original staff data (46 records)
- **DHCS_CLEANED.csv** - Generated by cleaning script (not in repo)
- **DUPLICATES_REVIEW.txt** - Generated by cleaning script (not in repo)

---

## ğŸš€ QUICK START GUIDE

### Prerequisites
1. Node.js installed
2. Admin access to ACG StaffLink
3. Dominion agency ID from database
4. Approval to proceed with migration

### Step-by-Step

```bash
# 1. Install dependencies
npm install papaparse

# 2. Update agency ID in cleaning script
# Edit clean_staff_data.js line 18:
# const DOMINION_AGENCY_ID = '[YOUR_AGENCY_ID]';

# 3. Run cleaning script
node dominion_doc/clean_staff_data.js

# 4. Review output
# - DHCS_CLEANED.csv (cleaned data)
# - DUPLICATES_REVIEW.txt (duplicates to resolve)

# 5. Upload to bulk import validator
# - Login to ACG StaffLink
# - Navigate to /bulkdataimport
# - Upload DHCS_CLEANED.csv
# - Review validation report

# 6. Test import (5 staff)
# - Create test CSV with first 5 staff
# - Import via bulk import utility
# - Verify no emails sent
# - Verify staff can login

# 7. Full import (41 staff)
# - Import remaining staff
# - Verify all 46 in database
# - Send welcome emails

# 8. Monitor & support
# - Track login activity
# - Send reminders (Day 3, Day 7)
# - Escalate stragglers (Day 14)
```

---

## ğŸ¯ KEY DECISIONS MADE

### âœ… Approved Strategy: HYBRID
- Bulk import staff with status='active' (NOT 'onboarding')
- Send ONE welcome email (not 46 individual invitations)
- Staff use "Forgot Password" to set initial password
- Staff complete missing profile fields themselves
- Admin monitors completion and sends reminders

### âŒ Rejected Alternatives
- **Option A:** Silent activation (staff can't login until password set)
  - Rejected: Too confusing for staff
- **Option B:** Admin completes all profiles manually
  - Rejected: Too time-consuming (7.6 hours)

### âš ï¸ Critical Findings
- Bulk import does NOT trigger email spam (verified in code audit)
- Status='active' skips automated reminder emails
- Database trigger only fires on user signup (not bulk import)
- Role change emails only fire on manual UI updates

---

## ğŸ“‹ DATA QUALITY ISSUES

| Issue | Count | Resolution |
|-------|-------|------------|
| Phone numbers missing +44 | ~46 | Auto-fixed by cleaning script |
| UK dates (DD/MM/YYYY) | ~46 | Auto-converted by validator |
| Missing bank details | ~10 | Import as-is, staff completes later |
| Missing DOB/address | ~5 | Import as-is, staff completes later |
| Duplicate emails | 2 | Manual review required |
| Duplicate phones | 2 | Manual review required |

---

## âœ… SUCCESS CRITERIA

**Migration Complete When:**
- âœ… All 46 staff in database with status='active'
- âœ… All phone numbers in E.164 format (+44...)
- âœ… Zero duplicate emails
- âœ… Welcome email sent to all staff
- âœ… 80%+ staff logged in within 7 days
- âœ… 60%+ profiles 100% complete within 14 days

---

## ğŸš¨ ROLLBACK PLAN

If migration fails or causes issues:

```sql
-- Delete all Dominion staff created during migration
DELETE FROM staff 
WHERE agency_id = '[DOMINION_AGENCY_ID]' 
  AND created_date > '[MIGRATION_START_DATE]';

-- Verify deletion
SELECT COUNT(*) FROM staff WHERE agency_id = '[DOMINION_AGENCY_ID]';
-- Expected: 0
```

---

## ğŸ“ SUPPORT & ESCALATION

**Migration Lead:** [Your Name]  
**Technical Support:** support@acg-stafflink.com  
**Dominion Contact:** [Dominion Admin Name/Email]

**Escalation Path:**
1. Staff can't login â†’ Password reset flow
2. Missing data â†’ Staff completes via portal
3. Technical issues â†’ Support ticket
4. No response after 14 days â†’ Phone call from admin

---

## ğŸ“Š TIMELINE

| Phase | Duration | Tasks |
|-------|----------|-------|
| **Phase 1: Data Preparation** | 1-2 hours | Clean CSV, validate, fix duplicates |
| **Phase 2: Bulk Import** | 30 minutes | Test import (5), full import (41) |
| **Phase 3: Staff Notification** | 1 hour | Send welcome emails, monitor delivery |
| **Phase 4: Monitoring** | Ongoing | Track logins, send reminders, support |

**Total Active Work:** 4-6 hours  
**Total Calendar Time:** 14 days (for monitoring)

---

## ğŸ” AUDIT FINDINGS

### âœ… What Works (Existing Infrastructure)
- Bulk import utility (`/bulkdataimport`)
- Bulk validator (`validate-bulk-import` Edge Function)
- Onboarding flow (ProfileSetup â†’ Staff Portal)
- Database trigger (`link_staff_on_signup()`)
- Notification system (Resend emails)

### âš ï¸ Notification Triggers (Verified Safe)
- Bulk import does NOT send emails
- Status='active' skips reminder emails
- Role change emails only on manual UI updates
- Invitation emails only when admin clicks "Invite"

### ğŸ¯ Recommended Approach
- Use existing bulk import utility (tested, validated)
- Set status='active' to avoid email spam
- Send custom welcome email (not invitation)
- Staff use "Forgot Password" for initial login
- Monitor completion and send gentle reminders

---

## ğŸ“ LESSONS LEARNED (Post-Migration)

**To be completed after migration:**

**What Went Well:**
- TBD

**What Could Be Improved:**
- TBD

**Issues Encountered:**
- TBD

**Recommendations for Future Migrations:**
- TBD

---

## ğŸ“„ FILE MANIFEST

```
dominion_doc/
â”œâ”€â”€ README.md (this file)
â”œâ”€â”€ MIGRATION_EXECUTIVE_SUMMARY.md (start here)
â”œâ”€â”€ DOMINION_STAFF_MIGRATION_STRATEGIC_PLAN.md (detailed plan)
â”œâ”€â”€ MIGRATION_CHECKLIST.md (execution checklist)
â”œâ”€â”€ clean_staff_data.js (data cleaning script)
â”œâ”€â”€ WELCOME_EMAIL_TEMPLATE.html (email template)
â”œâ”€â”€ DHCS - STAFF NAME  SORTED.csv (original data)
â”œâ”€â”€ DHCS_CLEANED.csv (generated by script)
â””â”€â”€ DUPLICATES_REVIEW.txt (generated by script)
```

---

**Ready to proceed? Start with [MIGRATION_EXECUTIVE_SUMMARY.md](MIGRATION_EXECUTIVE_SUMMARY.md)** ğŸš€

